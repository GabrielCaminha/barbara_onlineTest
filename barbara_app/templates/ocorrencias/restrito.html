<html><head><base href="https://197mulher.pe.gov.br/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>197 Mulher - Prote√ß√£o e Apoio √†s Mulheres em Pernambuco</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
      :root {
        --primary-purple: #8e44ad;
        --primary-pink: #e84393;
        --bg-white: #ffffff;
        --bg-pink-light: #fdf2f8;
        --text-gray: #2c3e50;
        --accent-blue: #3498db;
        --accent-green: #2ecc71;
      }
    
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
    
      body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--bg-pink-light);
        color: var(--text-gray);
        line-height: 1.6;
        padding-top: 80px;
      }
    
      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }
    
      header {
        background-color: var(--primary-purple);
        padding: 1rem 0;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
    
      .navbar-brand {
        display: flex;
        align-items: center;
        color: white;
        text-decoration: none;
        font-size: 1.5rem;
        font-weight: 600;
      }
    
      .navbar-brand img.logo {
        height: 40px;
        margin-right: 10px;
      }
    
      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
    
      nav ul {
        margin-left: auto;
        display: flex;
        list-style-type: none;
      }
    
      nav ul li {
        margin-left: 20px;
      }
    
      nav ul li a {
        color: white;
        text-decoration: none;
        font-weight: 300;
        transition: all 0.3s ease;
        padding: 5px 10px;
        border-radius: 5px;
      }
    
      nav ul li a:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }
    
      main {
        padding: 2rem 0;
      }
    
      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }
    
      .stat-card {
        background-color: var(--bg-white);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
    
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }
    
      .stat-card h3 {
        color: var(--primary-pink);
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
      }
    
      .stat-card p {
        font-size: 2.5rem;
        font-weight: 600;
        color: var(--accent-blue);
      }
    
      .stat-card i {
        font-size: 2rem;
        color: var(--primary-purple);
        margin-bottom: 1rem;
      }
    
      .victims-list, .aggressors-list, #medidas-protetivas {
        background-color: var(--bg-white);
        border-radius: 12px;
        padding: 2rem;
        margin-top: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
    
      .search-bar {
        width: 100%;
        padding: 0.8rem;
        margin-bottom: 1.5rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
    
      .search-bar:focus {
        outline: none;
        border-color: var(--primary-purple);
        box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.2);
      }
    
      .victim-item {
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        border-bottom: 1px solid #eee;
        transition: all 0.3s ease;
        position: relative;
      }
    
      .victim-item .victim-info-wrapper {
        display: flex;
        align-items: center;
      }
    
      .victim-item img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-right: 1.5rem;
        object-fit: cover;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
    
      .victim-info {
        flex-grow: 1;
      }
    
      .manage-button {
        align-self: flex-start;
      }
    
      .panic-alert {
        margin-top: 1rem;
        width: 100%;
      }
    
      .victim-item:hover {
        background-color: var(--bg-pink-light);
        transform: translateX(5px);
      }
    
      .manage-button {
        background-color: var(--primary-purple);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }
    
      .manage-button:hover {
        background-color: var(--primary-pink);
        transform: scale(1.05);
      }
    
      .panic-button {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 1.2rem 2.5rem;
        font-size: 1.3rem;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 2rem;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        display: block;
        width: 100%;
        max-width: 300px;
        margin-left: auto;
        margin-right: auto;
      }
    
      .panic-button:hover {
        background-color: #c0392b;
        transform: scale(1.05);
      }
    
      .panic-alert {
        display: none;
        background-color: #ff4757;
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
      }
    
      .panic-alert h4 {
        margin-bottom: 5px;
      }
    
      .panic-alert p {
        margin: 2px 0;
      }
    
      .view-map {
        color: white;
        text-decoration: underline;
        cursor: pointer;
      }
    
      #map-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1001;
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
    
      #map-container {
        width: 100%;
        height: 400px;
        border-radius: 10px;
        overflow: hidden;
      }
    
      #close-map {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 1.8rem;
        cursor: pointer;
        color: var(--primary-purple);
        transition: all 0.3s ease;
      }
    
      #close-map:hover {
        color: var(--primary-pink);
        transform: rotate(90deg);
      }
    
      footer {
        background-color: var(--primary-purple);
        color: white;
        text-align: center;
        padding: 1.5rem 0;
        margin-top: 3rem;
      }
    
      .popup {
        display: none;
        position: fixed;
        z-index: 1002;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
      }
    
      .popup-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 30px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }
    
      .popup-content h2 {
        color: var(--primary-purple);
        margin-bottom: 20px;
        text-align: center;
      }
    
      .popup-content-flex {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
    
      #popup-victim-image {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
      }
    
      #popup-victim-info p {
        margin: 10px 0;
        font-size: 14px;
      }
    
      #popup-victim-history {
        list-style-type: none;
        padding: 0;
      }
    
      #popup-victim-history li {
        margin-bottom: 10px;
        font-size: 14px;
      }
    
      .close-popup {
        color: var(--primary-purple);
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
      }
    
      .close-popup:hover {
        color: var(--primary-pink);
      }
    
      #addProtectiveMeasure {
        margin-right: 10px;
      }
    
      #appLinkContainer {
        margin-top: 20px;
      }
    
      .save-button {
        display: block;
        width: 100%;
        padding: 10px;
        background-color: var(--primary-purple);
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-top: 20px;
      }
    
      .save-button:hover {
        background-color: var(--primary-pink);
      }
    
      .aggressor-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #eee;
      }
    
      .aggressor-item img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 1rem;
      }
    
      .aggressor-info {
        flex-grow: 1;
      }
    
      .aggressor-item .manage-button {
        margin-left: 1rem;
      }
    
      @media (max-width: 1200px) {
        .container {
          width: 95%;
        }
      }
    
      @media (max-width: 992px) {
        .dashboard {
          grid-template-columns: repeat(2, 1fr);
        }
        
        #vitimas, #medidas-protetivas {
          width: 100%;
          display: block;
          margin-left: 0;
        }
      }
    
      @media (max-width: 768px) {
        body {
          font-size: 14px;
        }
    
        .dashboard {
          grid-template-columns: 1fr;
        }
    
        .stat-card h3 {
          font-size: 1rem;
        }
    
        .stat-card p {
          font-size: 2rem;
        }
    
        .victim-item, .aggressor-item {
          flex-direction: column;
          align-items: flex-start;
        }
    
        .victim-item img, .aggressor-item img {
          margin-bottom: 10px;
        }
    
        .manage-button {
          margin-top: 10px;
        }
    
        .popup-content {
          width: 95%;
          padding: 15px;
        }
    
        .popup-content-flex {
          flex-direction: column;
        }
    
        #popup-victim-image, #popup-aggressor-image {
          margin-bottom: 15px;
        }
      }
    
      @media (max-width: 576px) {
        .navbar-brand {
          font-size: 1.2rem;
        }
    
        .navbar-brand img.logo {
          height: 30px;
        }
    
        nav ul {
          display: none;
          flex-direction: column;
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background-color: var(--primary-purple);
          padding: 1rem 0;
        }
    
        nav ul.show {
          display: flex;
        }
    
        nav ul li {
          margin: 0.5rem 0;
        }
    
        .mobile-menu {
          display: block;
          font-size: 1.5rem;
          color: white;
          cursor: pointer;
        }
      }
    
      img {
        max-width: 100%;
        height: auto;
      }
    
      #map-container {
        width: 100%;
        height: 50vh;
      }
    </style>
</head>
<body>
  <header>
    <nav class="container">
      <a class="navbar-brand" href="#">
        <img src="https://pablodiego.com.br/brunno/barbara/logg.png" alt="Logo Unidade da Mulher" class="logo">
        Unidade da Mulher
      </a>
      <ul>
        <li><a href="https://pablodiego.com.br/brunno/barbara/dash.html" id="dashboard-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
        <li><a href="{% url 'lista_vitimas' %}"><i class="fas fa-users"></i> Lista de Mulheres V√≠timas de Abuso</a></li>
        <li><a href="#relatorios"><i class="fas fa-file-alt"></i> Relat√≥rios</a></li>
        <li><a href="#sair" id="sair-link"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
      </ul>
      <div class="mobile-menu">‚ò∞</div>
    </nav>
  </header>

  <main class="container">
    <section id="painel" class="dashboard">
      <div class="stat-card" id="total-victims">
        <i class="fas fa-female"></i>
        <h3>Total de V√≠timas</h3>
        <p>{{ total_vitimas }}</p>
      </div>
      <div class="stat-card" id="protected-victims">
        <i class="fas fa-user-shield"></i>
        <h3>V√≠timas Protegidas</h3>
        <p>{{ vitimas_protegidas }}</p>
      </div>
      <div class="stat-card" id="active-panic">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Bot√µes de P√¢nico Ativos</h3>
        <p>{{ botoes_panico_ativos }}</p>
      </div>
      <div class="stat-card" id="monthly-incidents">
        <i class="fas fa-calendar-check"></i>
        <h3>Incidentes no √öltimo M√™s</h3>
        <p>{{ incidentes_ultimo_mes }}</p>
      </div>
    </section>

    <section id="vitimas" class="victims-list">
      <h2><i class="fas fa-users"></i> Lista de Mulheres V√≠timas de Abuso</h2>
      <input type="text" class="search-bar" placeholder="Buscar por nome ou CPF">
      <ul>
        {% for vitima in vitimas %}
          <li>
            <p><strong>Nome:</strong> {{ vitima.nome }}</p>
            <p><strong>CPF:</strong> {{ vitima.cpf }}</p>
            <p><strong>Telefone:</strong> {{ vitima.telefone }}</p>
            <p><strong>Endere√ßo:</strong> {{ vitima.endereco }}</p>
            <p><strong>Idade:</strong> {{ vitima.idade }}</p>
            <p><strong>Estado Atual:</strong> {{ vitima.estado_atual }}</p>
            <p><strong>Medida Protetiva:</strong> {{ vitima.medida_protetiva|yesno:"Sim,N√£o" }}</p>
          </li>
        {% empty %}
          <p>Nenhuma v√≠tima cadastrada.</p>
        {% endfor %}
      </ul>
    </section>

    <section id="medidas-protetivas" class="victims-list">
      <h2><i class="fas fa-user-shield"></i> Mulheres com Medidas Protetivas</h2>
      <input type="text" class="search-bar" placeholder="Buscar por nome ou CPF">
      <ul>
        {% for vitima in vitimas %}
          {% if vitima.medida_protetiva %}
            <li>
              <p><strong>Nome:</strong> {{ vitima.nome }}</p>
              <p><strong>CPF:</strong> {{ vitima.cpf }}</p>
              <p><strong>Telefone:</strong> {{ vitima.telefone }}</p>
              <p><strong>Endere√ßo:</strong> {{ vitima.endereco }}</p>
            </li>
          {% endif %}
        {% empty %}
          <p>Nenhuma mulher com medida protetiva cadastrada.</p>
        {% endfor %}
      </ul>
    </section>

    <section id="agressores" class="aggressors-list">
      <h2><i class="fas fa-user-times"></i> Gerenciar Agressores</h2>
      <input type="text" class="search-bar" placeholder="Buscar por nome ou CPF">
      <ul>
        {% for agressor in agressores %}
          <li>
            <p><strong>Nome:</strong> {{ agressor.nome }}</p>
            <p><strong>CPF:</strong> {{ agressor.cpf }}</p>
            <p><strong>Idade:</strong> {{ agressor.idade }}</p>
          </li>
        {% empty %}
          <p>Nenhum agressor cadastrado.</p>
        {% endfor %}
      </ul>
    </section>

    <button class="panic-button" id="panic-button"><i class="fas fa-exclamation-circle"></i> BOT√ÉO DE P√ÇNICO</button>
  </main>
      <div id="victim-popup" class="popup">
        <div class="popup-content">
          <span class="close-popup">&times;</span>
          <h2 id="popup-victim-name"></h2>
          <div class="popup-content-flex">
            <img id="popup-victim-image" src="" alt="Foto da v√≠tima">
            <div id="popup-victim-info"></div>
          </div>
          <h3>Hist√≥rico de Ocorr√™ncias</h3>
          <ul id="popup-victim-history"></ul>
          <div>
            <input type="checkbox" id="addProtectiveMeasure" name="addProtectiveMeasure">
            <label for="addProtectiveMeasure">üëàüèª Adicionar √† lista de mulheres com medida protetiva</label>
          </div>
          <div id="appLinkContainer" style="display: none;">
            <p>Link para download do aplicativo:</p>
            <a href="#" id="appDownloadLink" target="_blank"></a>
          </div>
          <button id="save-victim-changes" class="save-button">Salvar</button>
        </div>
      </div>
    
      <div id="map-popup">
        <button id="close-map">&times;</button>
        <div id="map-container"></div>
      </div>
    
      <div id="aggressor-popup" class="popup">
        <div class="popup-content">
          <span class="close-popup">&times;</span>
          <h2 id="popup-aggressor-name"></h2>
          <div class="popup-content-flex">
            <img id="popup-aggressor-image" src="" alt="Foto do agressor">
            <div id="popup-aggressor-info"></div>
          </div>
          <h3>Ficha Criminal</h3>
          <ul id="popup-aggressor-history"></ul>
          <h3>Lista de V√≠timas</h3>
          <ul id="popup-aggressor-victims"></ul>
        </div>
      </div>
    
      <footer>
        <p>¬© 2024 197 Mulher - Pol√≠cia Civil de Pernambuco. Todos os direitos reservados.</p>
      </footer>
    
      <audio id="panicAlertSound" src="https://soundbible.com/grab.php?id=1542&type=mp3" loop></audio>
    
      <script>
        const aggressorImages = [
          "https://pablodiego.com.br/brunno/barbara/img/9.jpg",
          "https://pablodiego.com.br/brunno/barbara/img/10.jpg",
          "https://pablodiego.com.br/brunno/barbara/img/11.jpg"
        ];
    
        function updateDashboardRealTime() {
          const totalVictims = document.querySelectorAll('#vitimas .victim-item, #medidas-protetivas .victim-item').length;
          const protectedVictims = document.querySelectorAll('#medidas-protetivas .victim-item').length;
          const activePanicButtons = document.querySelectorAll('#medidas-protetivas .panic-alert:not(:empty)').length;
    
          document.getElementById('total-victims').querySelector('p').textContent = totalVictims;
          document.getElementById('protected-victims').querySelector('p').textContent = protectedVictims;
          document.getElementById('active-panic').querySelector('p').textContent = activePanicButtons;
        }
    
        function simulatePanicButton(victimItem) {
          const panicAlert = victimItem.querySelector('.panic-alert');
          const now = new Date();
          const formattedDate = `${now.getDate().toString().padStart(2, '0')}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getFullYear()}, ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
          
          const locations = [
            "Av. Conde da Boa Vista, 987, Recife - PE",
            "Rua da Aurora, 456, Recife - PE",
            "Av. Agamenon Magalh√£es, 2134, Recife - PE",
            "Rua do Sol, 789, Olinda - PE",
            "Av. Bernardo Vieira de Melo, 1234, Jaboat√£o dos Guararapes - PE"
          ];
          const randomLocation = locations[Math.floor(Math.random() * locations.length)];
          
          const phones = ["(81) 92109-8765", "(81) 98765-4321", "(81) 93456-7890", "(81) 97654-3210", "(81) 91234-5678"];
          const randomPhone = phones[Math.floor(Math.random() * phones.length)];
    
          panicAlert.innerHTML = `
            <h4>ALERTA: Bot√£o de p√¢nico acionado!</h4>
            <p>Data e hora do acionamento: ${formattedDate}</p>
            <p>Localiza√ß√£o: ${randomLocation}</p>
            <p><span class="view-map">(Ver no mapa)</span></p>
            <p>Telefone: ${randomPhone}</p>
            <p>Status: Aguardando atendimento</p>
          `;
          panicAlert.style.display = 'block';
          callUpdateDashboard();
        }
    
        function startPanicSimulation() {
          const victimItems = document.querySelectorAll('#medidas-protetivas .victim-item');
          victimItems.forEach((item, index) => {
            setTimeout(() => {
              simulatePanicButton(item);
            }, Math.random() * 60000 + index * 20000);
          });
        }
    
        function updateDashboard() {
          updateDashboardRealTime();
          document.getElementById('monthly-incidents').querySelector('p').textContent = Math.floor(Math.random() * 100);
        }
    
        function callUpdateDashboard() {
          updateDashboardRealTime();
        }
    
        function startPanicSimulation() {
          const victimItems = document.querySelectorAll('#medidas-protetivas .victim-item');
          victimItems.forEach((item, index) => {
            setTimeout(() => {
              simulatePanicButton(item);
            }, Math.random() * 60000 + index * 20000);
          });
        }
    
        const mapPopup = document.getElementById('map-popup');
        const closeMapButton = document.getElementById('close-map');
    
        function showMap() {
          mapPopup.style.display = 'block';
          const map = L.map('map-container').setView([-8.0476, -34.8770], 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
          L.marker([-8.0476, -34.8770]).addTo(map)
            .bindPopup('Localiza√ß√£o do Incidente')
            .openPopup();
        }
    
        closeMapButton.addEventListener('click', function() {
          mapPopup.style.display = 'none';
        });
    
        document.querySelectorAll('.victim-item').forEach(item => {
          item.addEventListener('click', showMap);
        });
    
        const victimPopup = document.getElementById('victim-popup');
        const closePopup = document.querySelector('.close-popup');
        const manageButtons = document.querySelectorAll('.manage-button');
    
        document.querySelectorAll('#vitimas .manage-button, #medidas-protetivas .manage-button').forEach(button => {
          button.addEventListener('click', function(event) {
            event.stopPropagation();
            const victimItem = this.closest('.victim-item');
            const victimName = victimItem.querySelector('h4').textContent;
            const victimImage = victimItem.querySelector('img').src;
            const lastOccurrence = victimItem.querySelector('p').textContent;
    
            const victimData = generateRandomVictimData(victimName);
    
            document.getElementById('popup-victim-name').textContent = victimName;
            document.getElementById('popup-victim-image').src = victimImage; // Use the same image URL
            document.getElementById('popup-victim-info').innerHTML = `
              <p><strong>${lastOccurrence}</strong></p>
              <p><strong>Idade:</strong> ${victimData.age}</p>
              <p><strong>Data de Nascimento:</strong> ${victimData.birthDate}</p>
              <p><strong>CPF:</strong> ${victimData.cpf}</p>
              <p><strong>RG:</strong> ${victimData.rg}</p>
              <p><strong>Telefone:</strong> ${victimData.phone}</p>
              <p><strong>Endere√ßo:</strong> ${victimData.address}</p>
              <p><strong>Ocupa√ß√£o:</strong> ${victimData.occupation}</p>
              <p><strong>Contato de Emerg√™ncia:</strong> ${victimData.emergencyContact}</p>
            `;
    
            document.getElementById('popup-victim-history').innerHTML = generateRandomHistory();
    
            const addProtectiveMeasureCheckbox = document.getElementById('addProtectiveMeasure');
            const appLinkContainer = document.getElementById('appLinkContainer');
            
            const isInProtectiveMeasures = victimItem.closest('#medidas-protetivas') !== null;
    
            if (isInProtectiveMeasures) {
              addProtectiveMeasureCheckbox.nextElementSibling.textContent = 'üëàüèª Remover da lista de mulheres com medida protetiva';
              appLinkContainer.style.display = 'block';
            } else {
              addProtectiveMeasureCheckbox.nextElementSibling.textContent = 'üëàüèª Adicionar √† lista de mulheres com medida protetiva';
              appLinkContainer.style.display = 'none';
            }
    
            addProtectiveMeasureCheckbox.checked = isInProtectiveMeasures;
    
            victimPopup.style.display = 'block';
    
            const saveButton = document.getElementById('save-victim-changes');
    
            saveButton.onclick = function() {
              if (addProtectiveMeasureCheckbox.checked !== isInProtectiveMeasures) {
                const newVictimElement = createVictimElement(victimName, victimImage, lastOccurrence);
                if (isInProtectiveMeasures) {
                  document.getElementById('vitimas').appendChild(newVictimElement);
                } else {
                  document.getElementById('medidas-protetivas').appendChild(newVictimElement);
                }
                victimItem.remove();
                callUpdateDashboard();
              }
              victimPopup.style.display = 'none';
            };
          });
        });
    
        function createVictimElement(name, image, lastOccurrence) {
          const div = document.createElement('div');
          div.className = 'victim-item';
          div.innerHTML = `
            <div class="victim-info-wrapper">
              <img src="${image}" alt="Foto de ${name}" width="80" height="80">
              <div class="victim-info">
                <h4>${name}</h4>
                <p>${lastOccurrence}</p>
              </div>
              <button class="manage-button">Gerenciar</button>
            </div>
            <div class="panic-alert"></div>
          `;
          div.querySelector('.manage-button').addEventListener('click', function(event) {
            document.querySelectorAll('#vitimas .manage-button, #medidas-protetivas .manage-button')[0].dispatchEvent(new Event('click'));
          });
          return div;
        }
    
        closePopup.addEventListener('click', function() {
          victimPopup.style.display = 'none';
        });
    
        window.addEventListener('click', function(event) {
          if (event.target == victimPopup) {
            victimPopup.style.display = 'none';
          }
        });
    
        const searchBars = document.querySelectorAll('.search-bar');
        searchBars.forEach(searchBar => {
          searchBar.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const items = this.parentElement.querySelectorAll('.victim-item, .aggressor-item');
            items.forEach(item => {
              const name = item.querySelector('h4').textContent.toLowerCase();
              if (name.includes(searchTerm)) {
                item.style.display = 'flex';
              } else {
                item.style.display = 'none';
              }
            });
          });
        });
    
        const mobileMenu = document.querySelector('.mobile-menu');
        const navList = document.querySelector('nav ul');
    
        mobileMenu.addEventListener('click', function() {
          navList.classList.toggle('show');
        });
    
        document.addEventListener('DOMContentLoaded', function() {
          updateDashboardRealTime();
          startPanicSimulation();
          
          const dashboardLink = document.getElementById('dashboard-link');
          
          dashboardLink.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = 'https://pablodiego.com.br/brunno/barbara/dash.html';
          });
    
          const sairLink = document.getElementById('sair-link');
          
          sairLink.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = 'https://pablodiego.com.br/brunno/barbara/barbara.html';
          });
        });
    
        const panicButton = document.getElementById('panic-button');
        const panicSound = document.getElementById('panicAlertSound');
    
        panicButton.addEventListener('click', function() {
          if (confirm('Tem certeza que deseja ativar o bot√£o de p√¢nico?')) {
            panicSound.play();
            alert('Alerta enviado! As autoridades foram notificadas.');
    
            if ('geolocation' in navigator) {
              navigator.geolocation.getCurrentPosition(function(position) {
                console.log('Latitude:', position.coords.latitude);
                console.log('Longitude:', position.coords.longitude);
              });
            }
          }
        });
        
        function generateRandomVictimData(name) {
          const occupations = ['Enfermeira', 'Professora', 'Advogada', 'Vendedora', 'Empres√°ria'];
          const streets = ['Rua da Hora', 'Avenida Boa Viagem', 'Rua do Sol', 'Avenida Caxang√°', 'Rua das Gra√ßas'];
          const neighborhoods = ['Espinheiro', 'Boa Viagem', 'Aflitos', 'Gra√ßas', 'Casa Forte'];
    
          return {
            age: Math.floor(Math.random() * (55 - 25) + 25),
            birthDate: `${1960 + Math.floor(Math.random() * 40)}-${String(Math.floor(Math.random() * 12) + 1).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`,
            cpf: `${Math.floor(Math.random() * 999)}.${Math.floor(Math.random() * 999)}.${Math.floor(Math.random() * 999)}-${Math.floor(Math.random() * 99)}`,
            rg: `${Math.floor(Math.random() * 9999999)} SSP/PE`,
            phone: `(81) 9${Math.floor(Math.random() * 9000) + 1000}-${Math.floor(Math.random() * 9000) + 1000}`,
            address: `${streets[Math.floor(Math.random() * streets.length)]}, ${Math.floor(Math.random() * 999)}, ${neighborhoods[Math.floor(Math.random() * neighborhoods.length)]}, Recife - PE`,
            occupation: occupations[Math.floor(Math.random() * occupations.length)],
            emergencyContact: `${generateRandomName()} (${['filho', 'irm√£', 'm√£e'][Math.floor(Math.random() * 3)]}) - (81) 9${Math.floor(Math.random() * 9000) + 1000}-${Math.floor(Math.random() * 9000) + 1000}`,
            imageUrl: `https://thispersondoesnotexist.com/image?${Math.random()}`
          };
        }
    
        function generateRandomName() {
          const firstNames = ['Maria', 'Ana', 'Joana', 'Carla', 'Fernanda'];
          const lastNames = ['Silva', 'Santos', 'Oliveira', 'Ferreira', 'Rodrigues'];
          return `${firstNames[Math.floor(Math.random() * firstNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`;
        }
    
        function generateRandomHistory() {
          const events = [
            'Amea√ßa verbal',
            'Agress√£o f√≠sica',
            'Viol√™ncia psicol√≥gica',
            'Tentativa de invas√£o de domic√≠lio',
            'Persegui√ß√£o',
            'Viol√™ncia patrimonial'
          ];
          let history = '';
          for (let i = 0; i < 3; i++) {
            const date = new Date(Date.now() - Math.random() * 90 * 24 * 60 * 60 * 1000);
            history += `<li><strong>${date.toLocaleDateString('pt-BR')}:</strong> ${events[Math.floor(Math.random() * events.length)]}</li>`;
          }
          return history;
        }
    
        function generateRandomAggressor(index) {
          const firstNames = ['Jo√£o', 'Pedro', 'Carlos', 'Ant√¥nio', 'Jos√©'];
          const lastNames = ['Silva', 'Santos', 'Oliveira', 'Ferreira', 'Rodrigues'];
          const victimFirstNames = ['Maria', 'Ana', 'Joana', 'Carla', 'Fernanda'];
    
          return {
            name: `${firstNames[Math.floor(Math.random() * firstNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`,
            age: Math.floor(Math.random() * (60 - 25) + 25),
            cpf: `${Math.floor(Math.random() * 999)}.${Math.floor(Math.random() * 999)}.${Math.floor(Math.random() * 999)}-${Math.floor(Math.random() * 99)}`,
            lastVictim: `${victimFirstNames[Math.floor(Math.random() * victimFirstNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`,
            imageUrl: aggressorImages[index % aggressorImages.length]
          };
        }
    
        function createAggressorElement(aggressor) {
          const div = document.createElement('div');
          div.className = 'aggressor-item';
          div.innerHTML = `
            <img src="${aggressor.imageUrl}" alt="Foto de ${aggressor.name}" width="60" height="60">
            <div class="aggressor-info">
              <h4>${aggressor.name}</h4>
              <p>Idade: ${aggressor.age} | CPF: ${aggressor.cpf}</p>
              <p>√öltima v√≠tima: ${aggressor.lastVictim}</p>
            </div>
            <button class="manage-button">Mais Detalhes</button>
          `;
          div.querySelector('.manage-button').addEventListener('click', () => showAggressorPopup(aggressor));
          return div;
        }
    
        function showAggressorPopup(aggressor) {
          const popup = document.getElementById('aggressor-popup');
          document.getElementById('popup-aggressor-name').textContent = aggressor.name;
          document.getElementById('popup-aggressor-image').src = aggressor.imageUrl;
          document.getElementById('popup-aggressor-info').innerHTML = `
            <p><strong>Idade:</strong> ${aggressor.age}</p>
            <p><strong>CPF:</strong> ${aggressor.cpf}</p>
            <p><strong>√öltima v√≠tima:</strong> ${aggressor.lastVictim}</p>
          `;
    
          const history = generateRandomAggressorHistory();
          document.getElementById('popup-aggressor-history').innerHTML = history;
    
          const victims = generateRandomVictimsList();
          document.getElementById('popup-aggressor-victims').innerHTML = victims;
    
          popup.style.display = 'block';
        }
    
        function generateRandomAggressorHistory() {
          const crimes = [
            'Agress√£o f√≠sica',
            'Amea√ßa',
            'Viol√™ncia dom√©stica',
            'Persegui√ß√£o',
            'Dano ao patrim√¥nio'
          ];
          let history = '';
          for (let i = 0; i < 5; i++) {
            const date = new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000);
            history += `<li><strong>${date.toLocaleDateString('pt-BR')}:</strong> ${crimes[Math.floor(Math.random() * crimes.length)]}</li>`;
          }
          return history;
        }
    
        function generateRandomVictimsList() {
          const statuses = ['Em acompanhamento psicol√≥gico', 'Com medida protetiva', 'Recuperada', 'Em abrigo'];
          let victims = '';
          for (let i = 0; i < 3; i++) {
            const name = generateRandomName();
            const status = statuses[Math.floor(Math.random() * statuses.length)];
            victims += `<li><strong>${name}:</strong> ${status}</li>`;
          }
          return victims;
        }
    
        function populateAggressorsList() {
          const aggressorsContainer = document.getElementById('aggressors-container');
          aggressorsContainer.innerHTML = '';
          for (let i = 0; i < 3; i++) {
            const aggressor = generateRandomAggressor(i);
            const aggressorElement = createAggressorElement(aggressor);
            aggressorsContainer.appendChild(aggressorElement);
          }
        }
    
        document.addEventListener('DOMContentLoaded', function() {
          populateAggressorsList();
          updateDashboardRealTime();
          
          const aggressorPopup = document.getElementById('aggressor-popup');
          const closeAggressorPopup = aggressorPopup.querySelector('.close-popup');
          closeAggressorPopup.addEventListener('click', function() {
            aggressorPopup.style.display = 'none';
          });
    
          window.addEventListener('click', function(event) {
            if (event.target == aggressorPopup) {
              aggressorPopup.style.display = 'none';
            }
          });
        });
        
        document.querySelectorAll('#medidas-protetivas .manage-button').forEach(button => {
          button.addEventListener('click', function(event) {
            event.stopPropagation();
            const victimItem = this.closest('.victim-item');
            const victimName = victimItem.querySelector('h4').textContent;
            const victimImage = victimItem.querySelector('img').src;
            const lastOccurrence = victimItem.querySelector('p').textContent;
    
            const victimData = generateRandomVictimData(victimName);
    
            document.getElementById('popup-victim-name').textContent = victimName;
            document.getElementById('popup-victim-image').src = victimImage; // Use the same image URL
            document.getElementById('popup-victim-info').innerHTML = `
              <p><strong>${lastOccurrence}</strong></p>
              <p><strong>Idade:</strong> ${victimData.age}</p>
              <p><strong>Data de Nascimento:</strong> ${victimData.birthDate}</p>
              <p><strong>CPF:</strong> ${victimData.cpf}</p>
              <p><strong>RG:</strong> ${victimData.rg}</p>
              <p><strong>Telefone:</strong> ${victimData.phone}</p>
              <p><strong>Endere√ßo:</strong> ${victimData.address}</p>
              <p><strong>Ocupa√ß√£o:</strong> ${victimData.occupation}</p>
              <p><strong>Contato de Emerg√™ncia:</strong> ${victimData.emergencyContact}</p>
            `;
    
            document.getElementById('popup-victim-history').innerHTML = generateRandomHistory();
    
            const addProtectiveMeasureCheckbox = document.getElementById('addProtectiveMeasure');
            const appLinkContainer = document.getElementById('appLinkContainer');
            
            addProtectiveMeasureCheckbox.nextElementSibling.textContent = 'üëàüèª Remover da lista de mulheres com medida protetiva';
            appLinkContainer.style.display = 'block';
            addProtectiveMeasureCheckbox.checked = true;
    
            victimPopup.style.display = 'block';
    
            const saveButton = document.getElementById('save-victim-changes');
    
            saveButton.onclick = function() {
              if (addProtectiveMeasureCheckbox.checked) {
                const newVictimElement = createVictimElement(victimName, victimImage, lastOccurrence);
                document.getElementById('vitimas').appendChild(newVictimElement);
                victimItem.remove();
                callUpdateDashboard();
              }
              victimPopup.style.display = 'none';
            };
          });
        });
      </script>
      <script>
        async function listarVitimas() {
            try {
                const response = await fetch('/vitimas/');
                const vitimas = await response.json();
                const vitimasContainer = document.getElementById('vitimas-container');
                vitimasContainer.innerHTML = '';
                vitimas.forEach(vitima => {
                    vitimasContainer.innerHTML += `
                        <div class="victim-item">
                            <h4>${vitima.nome}</h4>
                            <p>CPF: ${vitima.cpf}</p>
                            <p>√öltima ocorr√™ncia: ${vitima.ultima_ocorrencia}</p>
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Erro ao listar v√≠timas:', error);
            }
        }
        listarVitimas();
        async function criarVitima() {
        const novaVitima = {
            nome: document.getElementById('nome').value,
            cpf: document.getElementById('cpf').value,
            data_nascimento: document.getElementById('data_nascimento').value,
            endereco: document.getElementById('endereco').value,
            telefone: document.getElementById('telefone').value,
            ocupacao: document.getElementById('ocupacao').value,
            contato_emergencia: document.getElementById('contato_emergencia').value,
            ultima_ocorrencia: document.getElementById('ultima_ocorrencia').value,
        };
        try {
            const response = await fetch('/vitimas/criar/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(novaVitima),
            });
            if (response.ok) {
                alert('V√≠tima criada com sucesso!');
                listarVitimas();
            } else {
                alert('Erro ao criar v√≠tima');
            }
        } catch (error) {
            console.error('Erro ao criar v√≠tima:', error);
        }
    }
    async function atualizarVitima(vitimaId) {
        const dadosAtualizados = {
            nome: 'Novo Nome', // Ajuste conforme necess√°rio
            telefone: 'Novo Telefone'
        };
        try {
            const response = await fetch(`/vitimas/${vitimaId}/atualizar/`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dadosAtualizados),
            });
            if (response.ok) {
                alert('V√≠tima atualizada com sucesso!');
                listarVitimas();
            } else {
                alert('Erro ao atualizar v√≠tima');
            }
        } catch (error) {
            console.error('Erro ao atualizar v√≠tima:', error);
        }
    }
    
    </script>
    </body>
    </html>